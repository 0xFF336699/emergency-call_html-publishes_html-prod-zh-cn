{"version":3,"file":"static/chunks/6639.93aa81e3fe447dc9.js","mappings":"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","sources":["webpack://_N_E/../../libs/fanfanlo/src/events/EventDispatcher.ts","webpack://_N_E/../../libs/app/model/src/remote/project/listUserProjects.ts","webpack://_N_E/../../libs/droid/project-v2-ui/src/projects/sync/events.ts","webpack://_N_E/../../libs/droid/project-v2-ui/src/projects/sync/ProjectListSyncManager.ts","webpack://_N_E/../../libs/droid/project-v2-ui/src/projects/projectManager.ts","webpack://_N_E/../../libs/droid/project-v2-ui/src/index.ts"],"sourcesContent":["import { IEventHandler, IEventDispatcherEventMap, IEventDispatcherProperties } from './IEventDispatcher';\r\nimport { Event } from './Event';\r\n\r\ntype Listeners = IEventHandler[];\r\ntype ListenMap = Map<unknown, Listeners>; //Record<any, Listeners>\r\ntype OnceListener = Map<IEventHandler, IEventHandler>;\r\ntype OnceListeners = Map<unknown, OnceListener>; //Record<unknown, Record<any, any>>\r\nexport class EventDispatcher {\r\n  private listenDomainMap: Map<unknown, ListenMap> = new Map();\r\n  private listenMap: ListenMap = new Map<unknown, Listeners>();\r\n  private onceListeners: OnceListeners = new Map<unknown, OnceListener>();\r\n  addDomainEventListener<T extends IEventDispatcherEventMap>(\r\n    domain: unknown,\r\n    type: keyof T | unknown,\r\n    cb: T[keyof T] | IEventHandler,\r\n    index?: number,\r\n  ): void {\r\n    let _domain = this.listenDomainMap.get(domain);\r\n    if (!_domain) {\r\n      _domain = new Map();\r\n      this.listenDomainMap.set(domain, _domain);\r\n    }\r\n    let listeners = _domain.get(type);\r\n    if (!listeners) {\r\n      listeners = [];\r\n      _domain.set(type, listeners);\r\n    }\r\n    if (listeners.indexOf(cb as IEventHandler) == -1) listeners.push(cb as IEventHandler);\r\n    this.addEventListener(type, cb, index);\r\n  }\r\n\r\n  addDomainOnceListener<T extends IEventDispatcherEventMap>(\r\n    domain: unknown,\r\n    type: keyof T,\r\n    cb: T[keyof T],\r\n    index?: number,\r\n  ): void {\r\n    this.addOnceListener(type, cb, index, domain);\r\n  }\r\n\r\n  addEventListener<T extends IEventDispatcherEventMap>(\r\n    type: keyof T | unknown,\r\n    cb: T[keyof T] | IEventHandler,\r\n    index?: number,\r\n  ): void {\r\n    if (type === '') {\r\n      try {\r\n        throw new Error('addDomainEventListener error no type');\r\n      } catch (e) {\r\n        console.log('EventDispatcher2', 'addDomainEventListener', 'err', type, e);\r\n      }\r\n    }\r\n    if (typeof cb != 'function') {\r\n      try {\r\n        throw new Error('addDomainEventListener error no cb');\r\n      } catch (e) {\r\n        console.log('EventDispatcher2', 'addDomainEventListener', 'err', cb, e);\r\n      }\r\n    }\r\n    let listeners = this.listenMap.get(type);\r\n    if (!listeners) {\r\n      listeners = [];\r\n      this.listenMap.set(type, listeners);\r\n    }\r\n    const _index = listeners.indexOf(cb as IEventHandler);\r\n    if (_index > -1) listeners.splice(_index, 1);\r\n    if (index == undefined || index < 0) index = listeners.length;\r\n    index = Math.max(0, Math.min(index, listeners.length));\r\n    listeners.splice(index, 0, cb as IEventHandler);\r\n  }\r\n\r\n  addEventListenerOnce<T extends IEventDispatcherEventMap>(type: keyof T, cb: T[keyof T], index?: number): T[keyof T] {\r\n    return this.addOnceListener(type, cb, index, undefined);\r\n  }\r\n\r\n  private onceListenerCb<T extends IEventDispatcherEventMap>(\r\n    type: keyof T,\r\n    onEvent: T[keyof T],\r\n    domain?: unknown,\r\n  ): T[keyof T] {\r\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n    const that = this;\r\n    return function (...args: unknown[]) {\r\n      // onEvent(event);\r\n      if (typeof onEvent === 'function') {\r\n        onEvent(...args);\r\n      } else {\r\n        console.error(onEvent);\r\n        console.log(...args);\r\n        throw new Error('onEvent not a function');\r\n      }\r\n      // eslint-disable-next-line prefer-spread,@typescript-eslint/ban-types\r\n      // (onEvent as Function).apply(null, args)\r\n      // const listeners = that.onceListeners[type];\r\n      const listeners = that.onceListeners.get(type);\r\n      if (!listeners) return;\r\n      if (domain) that.removeDomainEventListener(domain, type, listeners.get(onEvent as IEventHandler) as T[keyof T]);\r\n      else that.removeEventListener(type, listeners.get(onEvent as IEventHandler) as T[keyof T]);\r\n    }.bind(this) as T[keyof T];\r\n  }\r\n  addOnceListener<T extends IEventDispatcherEventMap>(\r\n    type: keyof T,\r\n    onEvent: T[keyof T],\r\n    index?: number,\r\n    domain?: unknown,\r\n  ): T[keyof T] {\r\n    // let listeners = this.onceListeners[type];\r\n    let listeners = this.onceListeners.get(type);\r\n    if (!listeners) {\r\n      listeners = new Map();\r\n      this.onceListeners.set(type, listeners);\r\n    }\r\n\r\n    const fn = this.onceListenerCb<T>(type, onEvent, domain);\r\n    listeners.set(onEvent as IEventHandler, fn as IEventHandler);\r\n    domain ? this.addDomainEventListener(domain, type, fn, index) : this.addEventListener(type, fn, index);\r\n    return fn;\r\n  }\r\n\r\n  dispatchArgs<T extends IEventDispatcherEventMap>(type: keyof T, ...rest: unknown[]): boolean {\r\n    const listeners = this.listenMap.get(type);\r\n    if (!listeners) return false;\r\n    for (let i = 0, len = listeners.length; i < len; i++) {\r\n      listeners[i].apply(null, rest);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  dispatchEvent(event?: Event): boolean {\r\n    if (!event || !event.type) return true;\r\n    const listeners = this.listenMap.get(event.type);\r\n    if (!listeners) {\r\n      return false;\r\n    }\r\n    (event as any)[event._target] = this;\r\n    for (let i = 0, len = listeners.length; i < len; i++) {\r\n      if (event.canceled) return false;\r\n      try {\r\n        listeners[i](event);\r\n      } catch (e) {\r\n        console.log('EventDispatcher2', 'dispatchEvent', 'err', e);\r\n        console.log('event is', event);\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  removeDomain(domain: unknown): boolean {\r\n    const domainMap = this.listenDomainMap.get(domain);\r\n    if (!domainMap) return false;\r\n    for (const type in domainMap) {\r\n      domainMap.get(type)?.forEach((cb: IEventHandler) => {\r\n        try {\r\n          this.removeEventListener(type as keyof IEventDispatcherEventMap, cb);\r\n        } catch (e) {\r\n          console.log('eventdispatcher2', 'removedomain', 'err', e);\r\n        }\r\n      }, this);\r\n    }\r\n    this.listenDomainMap.delete(domain);\r\n    return true;\r\n  }\r\n\r\n  removeDomainEventListener<T extends IEventDispatcherEventMap>(\r\n    domain: unknown,\r\n    type: keyof T,\r\n    cb: T[keyof T],\r\n  ): boolean {\r\n    const domainMap = this.listenDomainMap.get(domain);\r\n    if (!domainMap) return false;\r\n    const listeners = domainMap.get(type);\r\n    if (!listeners) return false;\r\n    const index = listeners.indexOf(cb as IEventHandler);\r\n    if (index == -1) return false;\r\n    listeners.splice(index, 1);\r\n    return this.removeEventListener(type, cb);\r\n  }\r\n\r\n  removeEventListener<T extends IEventDispatcherEventMap>(type: keyof T, cb: T[keyof T]): boolean {\r\n    const listeners = this.listenMap.get(type);\r\n    if (!listeners) return false;\r\n    const index = listeners.indexOf(cb as IEventHandler);\r\n    if (index == -1) {\r\n      return false;\r\n    } else {\r\n      listeners.splice(index, 1);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  willTrigger<T extends IEventDispatcherEventMap>(type: keyof T | unknown): boolean {\r\n    const l = this.listenMap.get(type);\r\n    return !l || l.length == 0 ? false : true;\r\n    // return this.listenMap.get(type) !== undefined && this.listenMap.get(type)?.length > 0;\r\n  }\r\n  // add<T extends object>(type:IEventDispatcherProperties<T>) {}\r\n}\r\n","import { IRequestParams, IResultContent, request } from \"@fanfanlo\";\r\nimport { IRequestOptions } from \"../IRequestOptions\";\r\nimport { tms } from \"../tms\";\r\nimport type { IListUserProjectsParams, IListUserProjectsResult } from \"./types\";\r\n\r\n/**\r\n * 个人项目列表分页查询的请求参数\r\n */\r\nexport interface IListUserProjectsRequestParams extends IRequestParams {\r\n    data: IListUserProjectsParams;\r\n}\r\n\r\n/**\r\n * 个人项目列表分页查询的返回结果\r\n */\r\nexport interface IListUserProjectsRequestResult extends IResultContent {\r\n    urls: string[];                    // R2 URL 列表（公开项目为 CDN URL，私有项目为预签名 URL）\r\n    lastProjectUuid: string;           // 下次查询的游标（最后一条项目的 UUID）\r\n    hasMore: boolean;                  // 是否有更多数据\r\n    isLast: boolean;                   // 是否是最后一页\r\n}\r\n\r\n/**\r\n * 查询个人项目列表（游标分页）\r\n *\r\n * 功能说明：\r\n * - 使用游标分页查询当前用户的项目列表\r\n * - 公开项目返回 CDN URL\r\n * - 私有项目返回预签名 URL（1小时有效期）\r\n * - 已删除的项目不会被返回\r\n *\r\n * @param opts 请求选项\r\n * @returns 查询结果，包含 URL 列表、游标、分页标志\r\n *\r\n * @example\r\n * // 查询第一页\r\n * const result = await listUserProjects({\r\n *   params: {\r\n *     data: {\r\n *       pageSize: 10\r\n *     }\r\n *   },\r\n *   gateway: 'https://api.example.com'\r\n * });\r\n *\r\n * // 查询下一页\r\n * if (result.data?.hasMore) {\r\n *   const nextResult = await listUserProjects({\r\n *     params: {\r\n *       data: {\r\n *         latestSyncedProject: {\r\n *           uuid: result.data.lastProjectUuid,\r\n *           updatedAt: lastSyncedProject.updatedAt,\r\n *           version: lastSyncedProject.version,\r\n *           childrenVersion: lastSyncedProject.childrenVersion\r\n *         },\r\n *         pageSize: 10\r\n *       }\r\n *     },\r\n *     gateway: 'https://api.example.com'\r\n *   });\r\n * }\r\n */\r\nexport async function listUserProjects(opts: IRequestOptions<IListUserProjectsRequestParams>) {\r\n    console.log('[listUserProjects] 开始查询个人项目列表, params:', JSON.stringify(opts.params));\r\n\r\n    const res = await request<IListUserProjectsRequestResult>(\r\n        tms.TProject,\r\n        tms.MProjectListUserProjects,\r\n        opts.params,\r\n        opts.gateway,\r\n        opts.handler\r\n    );\r\n\r\n    if (res.shellIsOk) {\r\n        console.log('[listUserProjects] 请求成功, shellIsOk:', res.shellIsOk);\r\n    } else {\r\n        console.log('[listUserProjects] 请求失败, shellIsOk:', res.shellIsOk, 'err:', res.err);\r\n    }\r\n\r\n    if (res.dataIsOk) {\r\n        console.log('[listUserProjects] 数据正常, dataIsOk:', res.dataIsOk);\r\n    } else {\r\n        console.log('[listUserProjects] 数据异常, dataIsOk:', res.dataIsOk, 'errMsg:', res.data?.errMsg, 'errCode:', res.data?.errCode);\r\n    }\r\n\r\n    if (res.data) {\r\n        console.log('[listUserProjects] 完整响应数据:', JSON.stringify(res.data));\r\n        if (res.data.is_ok) {\r\n            console.log('[listUserProjects] 查询成功, urls数量:', res.data.urls?.length, 'hasMore:', res.data.hasMore, 'isLast:', res.data.isLast);\r\n        } else {\r\n            console.log('[listUserProjects] 查询失败, msg:', res.data.msg);\r\n        }\r\n    } else {\r\n        console.log('[listUserProjects] 无返回数据');\r\n    }\r\n\r\n    return res;\r\n}\r\n\r\nexport default listUserProjects;\r\n","/**\n * 用户个人projects同步 - 事件常量\n */\n\n/**\n * 同步开始事件\n */\nexport const SYNC_START = 'project:sync:start';\n\n/**\n * 单个项目同步成功事件\n */\nexport const SYNC_SUCCESS = 'project:sync:success';\n\n/**\n * 同步进度更新事件\n */\nexport const SYNC_PROGRESS = 'project:sync:progress';\n\n/**\n * 所有项目同步完成事件\n */\nexport const SYNC_COMPLETE = 'project:sync:complete';\n\n/**\n * 同步失败事件\n */\nexport const SYNC_FAILED = 'project:sync:failed';\n\n/**\n * 所有事件常量\n */\nexport const SYNC_EVENTS = {\n  SYNC_START,\n  SYNC_SUCCESS,\n  SYNC_PROGRESS,\n  SYNC_COMPLETE,\n  SYNC_FAILED,\n};\n","/**\r\n * 用户个人projects同步管理器\r\n */\r\n\r\nimport { Log } from '@fanfanlo';\r\nimport { EventDispatcher } from '@fanfanlo';\r\nimport { projectStore, IProject } from '@droid/project-v2-interface';\r\nimport { listUserProjects } from '@app/model';\r\nimport type { IListUserProjectsResult } from '@app/model';\r\nimport {\r\n  SYNC_START,\r\n  SYNC_SUCCESS,\r\n  SYNC_PROGRESS,\r\n  SYNC_COMPLETE,\r\n  SYNC_FAILED,\r\n} from './events';\r\nimport {\r\n  ExistingProjectInfo,\r\n  ProjectSyncOptions,\r\n  SyncProgress,\r\n  SyncFailureInfo,\r\n} from './types';\r\n\r\nconst fileLog = new Log(false, 'ProjectListSyncManager');\r\nfileLog.pause = true;\r\n\r\nclass ProjectListSyncManager extends EventDispatcher {\r\n  private isSyncing = false;\r\n  private pageSize = 30;\r\n  private latestSyncedProject: ExistingProjectInfo | undefined; // 最新同步的project信息（用于增量同步）\r\n\r\n  constructor() {\r\n    super();\r\n    fileLog.log('[ProjectListSyncManager] 构造函数调用');\r\n  }\r\n\r\n  /**\r\n   * 重置同步管理器状态\r\n   * 用于用户退出登录时清理数据\r\n   */\r\n  reset(): void {\r\n    const fnLog = fileLog.sub(false, 'reset_fn');\r\n    fnLog.log('[reset] 重置 ProjectListSyncManager');\r\n    this.latestSyncedProject = undefined;\r\n    this.isSyncing = false;\r\n    fnLog.log('[reset] 重置完成');\r\n  }\r\n\r\n  // async init(): Promise<void> {\r\n  //   const fnLog = fileLog.sub(false, 'init_fn');\r\n  //   fnLog.pause = true;\r\n  //   fnLog.log('[init] 开始初始化 ProjectListSyncManager');\r\n  //   try {\r\n  //     await this.sync();\r\n  //     fnLog.log('[init] ProjectListSyncManager 初始化完成');\r\n  //   } catch (error) {\r\n  //     fnLog.log('[init] ProjectListSyncManager 初始化失败:', error);\r\n  //   }\r\n  // }\r\n\r\n  async sync(): Promise<void> {\r\n    const fnLog = fileLog.sub(false, 'sync_fn');\r\n    // fnLog.pause = true;\r\n    fnLog.log('[sync] 开始同步');\r\n\r\n    if (this.isSyncing) {\r\n      fnLog.log('[sync] 已有同步在进行中，跳过');\r\n      return;\r\n    }\r\n\r\n    this.isSyncing = true;\r\n\r\n    try {\r\n\r\n      const projects = this.getProjectsFromStorage();\r\n      fnLog.log('[sync] 从 storage 读取 projects，数量:', projects.length);\r\n\r\n      let totalSynced = 0;\r\n\r\n      while (true) {\r\n        fnLog.log('[sync] 开始获取下一页，latestSyncedProject:', JSON.stringify(this.latestSyncedProject));\r\n\r\n        const syncResult = await this.callBackendAPI(this.latestSyncedProject);\r\n        fnLog.log('[sync] 后端 API 返回，urls 数量:', syncResult.urls.length, 'isLast:', syncResult.isLast, 'hasMore:', syncResult.hasMore);\r\n\r\n        if (syncResult.urls.length === 0) {\r\n          fnLog.log('[sync] 警告：后端返回的 urls 为空');\r\n          break;\r\n        }\r\n\r\n        for (let i = 0; i < syncResult.urls.length; i++) {\r\n          const url = syncResult.urls[i];\r\n          fnLog.log('[sync] 处理 URL[' + i + ']:', url);\r\n\r\n          // 不await，让其平行执行\r\n          this.processUrl(url, i, syncResult.urls.length);\r\n        }\r\n\r\n        // 从后端返回的数据更新 latestSyncedProject\r\n        \r\n          this.latestSyncedProject = syncResult.lastProjectInfo;\r\n          \r\n        if (syncResult.isLast) {\r\n          fnLog.log('[sync] 同步完成，isLast: true');\r\n          break;\r\n        }\r\n\r\n        if (!syncResult.hasMore) {\r\n          fnLog.log('[sync] 没有更多数据，hasMore: false');\r\n          break;\r\n        }\r\n\r\n        if(!this.latestSyncedProject){\r\n          fnLog.error(\"没有到最新一页，但是没有latestSyncedProject\")\r\n          return;\r\n        }\r\n        fnLog.log('[sync] 继续下一页，hasMore: true，latestSyncedProject:', JSON.stringify(this.latestSyncedProject));\r\n      }\r\n      fnLog.log('[sync] 派发 SYNC_COMPLETE 事件，totalSynced:', totalSynced);\r\n    } catch (error) {\r\n      fnLog.log('[sync] 同步过程中出错:', error);\r\n    } finally {\r\n      this.isSyncing = false;\r\n      fnLog.log('[sync] 同步结束');\r\n    }\r\n  }\r\n\r\n  private getProjectsFromStorage(): IProject[] {\r\n    const fnLog = fileLog.sub(false, 'getProjectsFromStorage_fn');\r\n    fnLog.pause = true;\r\n    fnLog.log('[getProjectsFromStorage] 开始读取 storage');\r\n    try {\r\n      const projects = projectStore.getListCopy();\r\n      fnLog.log('[getProjectsFromStorage] 读取成功，数量:', projects.length);\r\n\r\n      // 如果latestSyncedProject已经初始化过，则不重新初始化\r\n      if (this.latestSyncedProject) {\r\n        fnLog.log('[getProjectsFromStorage] latestSyncedProject已初始化，无需重新初始化:', JSON.stringify(this.latestSyncedProject));\r\n        return projects;\r\n      }\r\n\r\n      // 第一次调用，从storage中的项目找最新的来初始化\r\n      fnLog.log('[getProjectsFromStorage] 第一次调用，从项目中初始化latestSyncedProject');\r\n      let latestProject: IProject | undefined;\r\n      for (const project of projects) {\r\n        if (!latestProject) {\r\n          latestProject = project;\r\n        } else if (project.updatedAt && latestProject.updatedAt && project.updatedAt > latestProject.updatedAt) {\r\n          latestProject = project;\r\n        } else if (project.updatedAt && !latestProject.updatedAt) {\r\n          latestProject = project;\r\n        }\r\n      }\r\n\r\n      // 如果找到了最新的项目，初始化latestSyncedProject\r\n      if (latestProject && latestProject.uuid && latestProject.updatedAt) {\r\n        this.latestSyncedProject = {\r\n          uuid: latestProject.uuid,\r\n          updatedAt: latestProject.updatedAt,\r\n          version: latestProject.version || 0,\r\n          childrenVersion: latestProject.childrenVersion || 0,\r\n        };\r\n        fnLog.log('[getProjectsFromStorage] 初始化 latestSyncedProject:', JSON.stringify(this.latestSyncedProject));\r\n      } else {\r\n        fnLog.log('[getProjectsFromStorage] 未找到有效的最新项目，latestSyncedProject 保持 undefined');\r\n        this.latestSyncedProject = undefined;\r\n      }\r\n\r\n      return projects;\r\n    } catch (error) {\r\n      fnLog.log('[getProjectsFromStorage] 读取失败:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  private async callBackendAPI(\r\n    latestSyncedProject?: ExistingProjectInfo\r\n  ): Promise<IListUserProjectsResult> {\r\n    const fnLog = fileLog.sub(false, 'callBackendAPI_fn');\r\n    fnLog.pause = true;\r\n    fnLog.log('[callBackendAPI] 开始调用后端 API，latestSyncedProject:', JSON.stringify(latestSyncedProject));\r\n\r\n    try {\r\n      const requestData: any = {\r\n        pageSize: this.pageSize,\r\n      };\r\n\r\n      if (latestSyncedProject) {\r\n        fnLog.log('[callBackendAPI] 添加 latestSyncedProject:', JSON.stringify(latestSyncedProject));\r\n        requestData.latestSyncedProject = latestSyncedProject;\r\n      } else {\r\n        fnLog.log('[callBackendAPI] 首次查询，无 latestSyncedProject');\r\n      }\r\n\r\n      const requestParams = {\r\n        data: requestData,\r\n      };\r\n\r\n      fnLog.log('[callBackendAPI] 请求参数:', JSON.stringify(requestParams));\r\n\r\n      // 使用 listUserProjects 函数调用后端 API，不需要硬编码 gateway\r\n      const res = await listUserProjects({\r\n        params: requestParams,\r\n      });\r\n\r\n      fnLog.log('[callBackendAPI] 响应状态 - shellIsOk:', res.shellIsOk, 'dataIsOk:', res.dataIsOk);\r\n\r\n      if (!res.shellIsOk) {\r\n        throw new Error('API 请求失败，shellIsOk: ' + res.shellIsOk);\r\n      }\r\n\r\n      if (!res.dataIsOk) {\r\n        throw new Error('API 数据异常，dataIsOk: ' + res.dataIsOk);\r\n      }\r\n\r\n      if (!res.data) {\r\n        throw new Error('API 返回数据为空');\r\n      }\r\n\r\n      if (!res.data.is_ok) {\r\n        throw new Error('API 返回错误: ' + res.data.msg);\r\n      }\r\n\r\n      fnLog.log('[callBackendAPI] 响应数据:', JSON.stringify(res.data));\r\n\r\n      fnLog.log('[callBackendAPI] 返回数据 - is_ok:', res.data.is_ok, 'urls:', res.data.urls?.length, 'lastProjectUuid:', res.data.lastProjectUuid, 'isLast:', res.data.isLast);\r\n      return res.data;\r\n    } catch (error) {\r\n      fnLog.log('[callBackendAPI] 调用失败:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async fetchProjectJson(url: string): Promise<any> {\r\n    const fnLog = fileLog.sub(false, 'fetchProjectJson_fn');\r\n    fnLog.pause = true;\r\n    fnLog.log('[fetchProjectJson] 开始获取 JSON，URL:', url);\r\n\r\n    try {\r\n      const response = await fetch(url);\r\n      fnLog.log('[fetchProjectJson] 响应状态:', response.status);\r\n\r\n      if (!response.ok) {\r\n        throw new Error('获取 JSON 失败，状态码: ' + response.status);\r\n      }\r\n\r\n      const json = await response.json();\r\n      fnLog.log('[fetchProjectJson] 获取成功');\r\n      return json;\r\n    } catch (error) {\r\n      fnLog.log('[fetchProjectJson] 获取失败:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async convertJsonToProject(json: any): Promise<IProject> {\r\n    const fnLog = fileLog.sub(false, 'convertJsonToProject_fn');\r\n    fnLog.pause = true;\r\n    fnLog.log('[convertJsonToProject] 开始转换，json:', JSON.stringify(json));\r\n\r\n    try {\r\n      if (!json || typeof json !== 'object') {\r\n        fnLog.log('[convertJsonToProject] JSON 数据无效');\r\n        throw new Error('无效的 JSON 数据');\r\n      }\r\n\r\n      let ulid = '';\r\n      if (json.ulid !== undefined && json.ulid !== null && json.ulid !== '') {\r\n        ulid = json.ulid;\r\n        fnLog.log('[convertJsonToProject] 使用 json.ulid:', ulid);\r\n      } else {\r\n        fnLog.log('[convertJsonToProject] json.ulid 为空，使用默认值: \"\"');\r\n      }\r\n\r\n      const project: IProject = {\r\n        ...json,  // 先展开所有字段\r\n        ulid,     // 然后明确设置 ulid，确保它不会被覆盖\r\n        uuid: json.uuid,\r\n        version: json.version,\r\n        childrenVersion: json.childrenVersion,\r\n        children: json.children,\r\n      };\r\n\r\n      fnLog.log('[convertJsonToProject] 转换成功，ulid:', project.ulid, 'uuid:', project.uuid);\r\n      return project;\r\n    } catch (error) {\r\n      fnLog.log('[convertJsonToProject] 转换失败:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async saveProjectToStorage(project: IProject): Promise<void> {\r\n    const fnLog = fileLog.sub(false, 'saveProjectToStorage_fn');\r\n    fnLog.pause = true;\r\n    fnLog.log('[saveProjectToStorage] 开始保存，ulid:', project.ulid);\r\n\r\n    try {\r\n      projectStore.saveProject(project);\r\n      fnLog.log('[saveProjectToStorage] 保存成功，ulid:', project.ulid);\r\n    } catch (error) {\r\n      fnLog.log('[saveProjectToStorage] 保存失败:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async processUrl(url: string, index: number, total: number): Promise<void> {\r\n    const fnLog = fileLog.sub(false, 'processUrl_fn');\r\n    fnLog.pause = true;\r\n\r\n    try {\r\n      const json = await this.fetchProjectJson(url);\r\n      fnLog.log('[sync] 获取 JSON 成功，URL:', url);\r\n\r\n      const project = await this.convertJsonToProject(json);\r\n      fnLog.log('[sync] 转换为 project 对象，ulid:', project.ulid);\r\n\r\n      await this.saveProjectToStorage(project);\r\n      fnLog.log('[sync] 保存到 storage 成功，ulid:', project.ulid);\r\n\r\n      this.dispatchArgs(SYNC_SUCCESS, {\r\n        project,\r\n        index,\r\n        total,\r\n      });\r\n      fnLog.log('[sync] 派发 SYNC_SUCCESS 事件，index:', index);\r\n\r\n      totalSynced++;\r\n    } catch (error) {\r\n      fnLog.log('[sync] 处理 URL 失败，URL:', url, 'error:', error);\r\n\r\n      this.dispatchArgs(SYNC_FAILED, {\r\n        error: String(error),\r\n        failedUrl: url,\r\n        retryable: true,\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport const projectListSyncManager = new ProjectListSyncManager();\r\n","import { User, user } from \"@app/model\";\r\nimport { projectStore } from \"@droid/project-v2-interface\";\r\nimport { Log, proxyWatch } from \"@fanfanlo\";\r\nimport { projectListSyncManager } from \"./sync\";\r\nimport { initProjectSystem } from \"@droid/project-v2-ext\";\r\n\r\nconst fileLog = new Log(false, 'projectManager_f')\r\nfileLog.pause = true;\r\n\r\nfunction init(){\r\n    initProjectSystem()\r\n    fileLog.log('projectMangerInit')\r\n    user.addListener(User.SignOutEvent, onUserSignout);\r\n    checkSyncProjects()\r\n    proxyWatch(user, 'data.storeData.user_token', onUserChanged)\r\n}\r\n\r\nfunction onUserChanged(){\r\n    checkSyncProjects()\r\n}\r\nfunction onUserSignout(){\r\n    const fnLog = fileLog.sub(false, 'onUserSignout_fn');\r\n    fnLog.log('[onUserSignout] 开始清理用户数据');\r\n\r\n    projectStore.cleanStorage();\r\n    fnLog.log('[onUserSignout] projectStore 已清理');\r\n\r\n    projectListSyncManager.reset();\r\n    fnLog.log('[onUserSignout] projectListSyncManager 已重置');\r\n\r\n    fnLog.log('[onUserSignout] 用户数据清理完成');\r\n}\r\nfunction checkSyncProjects(){\r\n    fileLog.log('checkSyncProjects')\r\n    if(!user.data.storeData.user_token)return;\r\n    fileLog.log('sync manager')\r\n    projectListSyncManager.sync()\r\n}\r\nexport const projectManager = {\r\n    init,\r\n}","export * from './contexts'\r\nexport * from './ui/projects/ProjectsInfoItemUI'\r\nexport * from './ui/project/ProjectUI'\r\nexport * from './ui/project/edit-project/EditProject'\r\nexport * from './ui/project/edit-project/MarketModeWrapper'\r\nexport * from './ui/components/CreateProjectButton'\r\nexport * from './manager'\r\nexport * from './utils/projectUtils'\r\nexport * from './utils/projectSyncUtils'\r\n// export * from './projects/sync'\r\nexport * from './projects/projectManager'\r\nexport * from './ui/market'"],"names":["EventDispatcher","addDomainEventListener","domain","type","cb","index","_domain","listenDomainMap","get","Map","set","listeners","indexOf","push","addEventListener","addDomainOnceListener","addOnceListener","Error","e","console","log","listenMap","_index","splice","undefined","length","Math","max","min","addEventListenerOnce","onceListenerCb","onEvent","that","args","error","onceListeners","removeDomainEventListener","removeEventListener","bind","fn","dispatchArgs","rest","i","len","apply","dispatchEvent","event","_target","canceled","removeDomain","domainMap","forEach","delete","willTrigger","l","request","tms","listUserProjects","opts","JSON","stringify","params","res","TProject","MProjectListUserProjects","gateway","handler","shellIsOk","err","dataIsOk","data","errMsg","errCode","is_ok","urls","hasMore","isLast","msg","SYNC_START","SYNC_SUCCESS","SYNC_PROGRESS","SYNC_COMPLETE","SYNC_FAILED","SYNC_EVENTS","Log","projectStore","fileLog","pause","ProjectListSyncManager","reset","fnLog","sub","latestSyncedProject","isSyncing","sync","projects","getProjectsFromStorage","totalSynced","syncResult","callBackendAPI","url","processUrl","lastProjectInfo","getListCopy","latestProject","project","updatedAt","uuid","version","childrenVersion","requestData","pageSize","requestParams","lastProjectUuid","fetchProjectJson","response","fetch","status","ok","json","convertJsonToProject","ulid","children","saveProjectToStorage","saveProject","total","String","failedUrl","retryable","constructor","projectListSyncManager","User","user","proxyWatch","initProjectSystem","init","addListener","SignOutEvent","onUserSignout","checkSyncProjects","onUserChanged","cleanStorage","storeData","user_token","projectManager"],"sourceRoot":"","ignoreList":[]}